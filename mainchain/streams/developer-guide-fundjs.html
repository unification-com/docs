<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developer Guide: fundjs | Documentation</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/assets/common/unification_icon.png">
    <meta name="description" content="Documentation for all Unification Projects">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.84c1e0ec.css" as="style"><link rel="preload" href="/assets/js/app.55c2b24c.js" as="script"><link rel="preload" href="/assets/js/2.ab437a62.js" as="script"><link rel="preload" href="/assets/js/460.510ee695.js" as="script"><link rel="prefetch" href="/assets/js/10.f797ecd9.js"><link rel="prefetch" href="/assets/js/100.d23c260f.js"><link rel="prefetch" href="/assets/js/101.697a9fc6.js"><link rel="prefetch" href="/assets/js/102.77e1542e.js"><link rel="prefetch" href="/assets/js/103.e04f3622.js"><link rel="prefetch" href="/assets/js/104.fc3d2699.js"><link rel="prefetch" href="/assets/js/105.4209140c.js"><link rel="prefetch" href="/assets/js/106.f914ef34.js"><link rel="prefetch" href="/assets/js/107.f4fcd953.js"><link rel="prefetch" href="/assets/js/108.45299906.js"><link rel="prefetch" href="/assets/js/109.8fb77db8.js"><link rel="prefetch" href="/assets/js/11.6d5fc14b.js"><link rel="prefetch" href="/assets/js/110.4fcc754d.js"><link rel="prefetch" href="/assets/js/111.0f54c89f.js"><link rel="prefetch" href="/assets/js/112.751b77b6.js"><link rel="prefetch" href="/assets/js/113.f2674730.js"><link rel="prefetch" href="/assets/js/114.a970d141.js"><link rel="prefetch" href="/assets/js/115.6911a873.js"><link rel="prefetch" href="/assets/js/116.58bb58b8.js"><link rel="prefetch" href="/assets/js/117.67adbfaf.js"><link rel="prefetch" href="/assets/js/118.1ac7d1f5.js"><link rel="prefetch" href="/assets/js/119.907c2009.js"><link rel="prefetch" href="/assets/js/12.488d2691.js"><link rel="prefetch" href="/assets/js/120.78ec1e43.js"><link rel="prefetch" href="/assets/js/121.34768bfd.js"><link rel="prefetch" href="/assets/js/122.28ad2675.js"><link rel="prefetch" href="/assets/js/123.cee45229.js"><link rel="prefetch" href="/assets/js/124.898ef230.js"><link rel="prefetch" href="/assets/js/125.78514696.js"><link rel="prefetch" href="/assets/js/126.6fcab395.js"><link rel="prefetch" href="/assets/js/127.7e43b0c4.js"><link rel="prefetch" href="/assets/js/128.26056716.js"><link rel="prefetch" href="/assets/js/129.af7d083f.js"><link rel="prefetch" href="/assets/js/13.5863a224.js"><link rel="prefetch" href="/assets/js/130.e0d9871d.js"><link rel="prefetch" href="/assets/js/131.bfc1e322.js"><link rel="prefetch" href="/assets/js/132.326bbb7d.js"><link rel="prefetch" href="/assets/js/133.b8869b36.js"><link rel="prefetch" href="/assets/js/134.ab1cbbff.js"><link rel="prefetch" href="/assets/js/135.0a4301b5.js"><link rel="prefetch" href="/assets/js/136.622ac2d5.js"><link rel="prefetch" href="/assets/js/137.7aa637ef.js"><link rel="prefetch" href="/assets/js/138.7e4db295.js"><link rel="prefetch" href="/assets/js/139.83c0d16e.js"><link rel="prefetch" href="/assets/js/14.e9318db0.js"><link rel="prefetch" href="/assets/js/140.6a529d2c.js"><link rel="prefetch" href="/assets/js/141.1dff34ec.js"><link rel="prefetch" href="/assets/js/142.62e1f0d5.js"><link rel="prefetch" href="/assets/js/143.3d2c33b5.js"><link rel="prefetch" href="/assets/js/144.019d5f34.js"><link rel="prefetch" href="/assets/js/145.de7625e2.js"><link rel="prefetch" href="/assets/js/146.fd05b91a.js"><link rel="prefetch" href="/assets/js/147.2bfc3c30.js"><link rel="prefetch" href="/assets/js/148.79ece6ef.js"><link rel="prefetch" href="/assets/js/149.57b20e2b.js"><link rel="prefetch" href="/assets/js/15.af112e3a.js"><link rel="prefetch" href="/assets/js/150.3dc28da2.js"><link rel="prefetch" href="/assets/js/151.77e4b519.js"><link rel="prefetch" href="/assets/js/152.3ecb3808.js"><link rel="prefetch" href="/assets/js/153.281398a7.js"><link rel="prefetch" href="/assets/js/154.84ecafcb.js"><link rel="prefetch" href="/assets/js/155.23a8167d.js"><link rel="prefetch" href="/assets/js/156.ed4ed077.js"><link rel="prefetch" href="/assets/js/157.8fc13228.js"><link rel="prefetch" href="/assets/js/158.ee67a802.js"><link rel="prefetch" href="/assets/js/159.a0ac2211.js"><link rel="prefetch" href="/assets/js/16.f2333f86.js"><link rel="prefetch" href="/assets/js/160.12c6d31b.js"><link rel="prefetch" href="/assets/js/161.3b680ff5.js"><link rel="prefetch" href="/assets/js/162.9f3dccca.js"><link rel="prefetch" href="/assets/js/163.d49056ea.js"><link rel="prefetch" href="/assets/js/164.18c58e3c.js"><link rel="prefetch" href="/assets/js/165.4e1b2b64.js"><link rel="prefetch" href="/assets/js/166.0b96daca.js"><link rel="prefetch" href="/assets/js/167.2683b5ea.js"><link rel="prefetch" href="/assets/js/168.96666098.js"><link rel="prefetch" href="/assets/js/169.8cdb393c.js"><link rel="prefetch" href="/assets/js/17.5c70aec7.js"><link rel="prefetch" href="/assets/js/170.bb8cc9f9.js"><link rel="prefetch" href="/assets/js/171.b15476e6.js"><link rel="prefetch" href="/assets/js/172.8f320eb8.js"><link rel="prefetch" href="/assets/js/173.4f15636e.js"><link rel="prefetch" href="/assets/js/174.2b005098.js"><link rel="prefetch" href="/assets/js/175.ac011e5f.js"><link rel="prefetch" href="/assets/js/176.46928172.js"><link rel="prefetch" href="/assets/js/177.2831f806.js"><link rel="prefetch" href="/assets/js/178.9a99ec25.js"><link rel="prefetch" href="/assets/js/179.24bab213.js"><link rel="prefetch" href="/assets/js/18.75852914.js"><link rel="prefetch" href="/assets/js/180.8326cac8.js"><link rel="prefetch" href="/assets/js/181.86f0618d.js"><link rel="prefetch" href="/assets/js/182.0fa71e56.js"><link rel="prefetch" href="/assets/js/183.dce08053.js"><link rel="prefetch" href="/assets/js/184.d08febbf.js"><link rel="prefetch" href="/assets/js/185.c13dd0c4.js"><link rel="prefetch" href="/assets/js/186.d96a41b8.js"><link rel="prefetch" href="/assets/js/187.2eda092c.js"><link rel="prefetch" href="/assets/js/188.aba91559.js"><link rel="prefetch" href="/assets/js/189.13b39a77.js"><link rel="prefetch" href="/assets/js/19.1a0df0a4.js"><link rel="prefetch" href="/assets/js/190.8633d2f9.js"><link rel="prefetch" href="/assets/js/191.d8873cfe.js"><link rel="prefetch" href="/assets/js/192.32d45a13.js"><link rel="prefetch" href="/assets/js/193.6716b25f.js"><link rel="prefetch" href="/assets/js/194.206cab8d.js"><link rel="prefetch" href="/assets/js/195.363e09e7.js"><link rel="prefetch" href="/assets/js/196.0ce2aa35.js"><link rel="prefetch" href="/assets/js/197.0d9f56a8.js"><link rel="prefetch" href="/assets/js/198.910cb505.js"><link rel="prefetch" href="/assets/js/199.38193e3e.js"><link rel="prefetch" href="/assets/js/20.0faada38.js"><link rel="prefetch" href="/assets/js/200.750b57ef.js"><link rel="prefetch" href="/assets/js/201.85cf4ecc.js"><link rel="prefetch" href="/assets/js/202.dcde437a.js"><link rel="prefetch" href="/assets/js/203.6457dfde.js"><link rel="prefetch" href="/assets/js/204.b7ce92db.js"><link rel="prefetch" href="/assets/js/205.62368b48.js"><link rel="prefetch" href="/assets/js/206.f8d4f4e2.js"><link rel="prefetch" href="/assets/js/207.042c5a15.js"><link rel="prefetch" href="/assets/js/208.204c7491.js"><link rel="prefetch" href="/assets/js/209.42300afd.js"><link rel="prefetch" href="/assets/js/21.950e731d.js"><link rel="prefetch" href="/assets/js/210.a80dbb67.js"><link rel="prefetch" href="/assets/js/211.bf285d3e.js"><link rel="prefetch" href="/assets/js/212.1dfe4e92.js"><link rel="prefetch" href="/assets/js/213.e37cab4a.js"><link rel="prefetch" href="/assets/js/214.17392e99.js"><link rel="prefetch" href="/assets/js/215.78ea36e8.js"><link rel="prefetch" href="/assets/js/216.3d2659a6.js"><link rel="prefetch" href="/assets/js/217.d5679e07.js"><link rel="prefetch" href="/assets/js/218.4c1db071.js"><link rel="prefetch" href="/assets/js/219.57a93d8b.js"><link rel="prefetch" href="/assets/js/22.d02db938.js"><link rel="prefetch" href="/assets/js/220.95cadbd3.js"><link rel="prefetch" href="/assets/js/221.07c90cb3.js"><link rel="prefetch" href="/assets/js/222.739d28c3.js"><link rel="prefetch" href="/assets/js/223.c090298a.js"><link rel="prefetch" href="/assets/js/224.ffeb6eb8.js"><link rel="prefetch" href="/assets/js/225.474e3d8b.js"><link rel="prefetch" href="/assets/js/226.fae5e268.js"><link rel="prefetch" href="/assets/js/227.f520cf15.js"><link rel="prefetch" href="/assets/js/228.0d1d56d0.js"><link rel="prefetch" href="/assets/js/229.06263fa0.js"><link rel="prefetch" href="/assets/js/23.0e19e55e.js"><link rel="prefetch" href="/assets/js/230.17bd1ef9.js"><link rel="prefetch" href="/assets/js/231.e83000cf.js"><link rel="prefetch" href="/assets/js/232.55b497ae.js"><link rel="prefetch" href="/assets/js/233.d18739ce.js"><link rel="prefetch" href="/assets/js/234.f1edc34a.js"><link rel="prefetch" href="/assets/js/235.5f095daa.js"><link rel="prefetch" href="/assets/js/236.51f301e1.js"><link rel="prefetch" href="/assets/js/237.6b9bbc9f.js"><link rel="prefetch" href="/assets/js/238.0704e3ef.js"><link rel="prefetch" href="/assets/js/239.917ef3ee.js"><link rel="prefetch" href="/assets/js/24.ab664485.js"><link rel="prefetch" href="/assets/js/240.d4ae46c1.js"><link rel="prefetch" href="/assets/js/241.8c079f28.js"><link rel="prefetch" href="/assets/js/242.d1e8b445.js"><link rel="prefetch" href="/assets/js/243.fcb356ca.js"><link rel="prefetch" href="/assets/js/244.2490e1cc.js"><link rel="prefetch" href="/assets/js/245.263579ae.js"><link rel="prefetch" href="/assets/js/246.37508d50.js"><link rel="prefetch" href="/assets/js/247.8126a69f.js"><link rel="prefetch" href="/assets/js/248.fbc71ac3.js"><link rel="prefetch" href="/assets/js/249.91aa5fd9.js"><link rel="prefetch" href="/assets/js/25.cb9b4715.js"><link rel="prefetch" href="/assets/js/250.e0deb264.js"><link rel="prefetch" href="/assets/js/251.2f50fabf.js"><link rel="prefetch" href="/assets/js/252.2f889351.js"><link rel="prefetch" href="/assets/js/253.94ae9eec.js"><link rel="prefetch" href="/assets/js/254.bdfc01aa.js"><link rel="prefetch" href="/assets/js/255.8e8c4a86.js"><link rel="prefetch" href="/assets/js/256.b5468414.js"><link rel="prefetch" href="/assets/js/257.af9a80cf.js"><link rel="prefetch" href="/assets/js/258.9f8e3972.js"><link rel="prefetch" href="/assets/js/259.b85072e9.js"><link rel="prefetch" href="/assets/js/26.386679aa.js"><link rel="prefetch" href="/assets/js/260.7e0c705e.js"><link rel="prefetch" href="/assets/js/261.33fe4c4b.js"><link rel="prefetch" href="/assets/js/262.87e3e9d5.js"><link rel="prefetch" href="/assets/js/263.6d89a90a.js"><link rel="prefetch" href="/assets/js/264.5cde8d8b.js"><link rel="prefetch" href="/assets/js/265.328d8107.js"><link rel="prefetch" href="/assets/js/266.5c5c26e8.js"><link rel="prefetch" href="/assets/js/267.629551e4.js"><link rel="prefetch" href="/assets/js/268.f1697920.js"><link rel="prefetch" href="/assets/js/269.4ad0e54a.js"><link rel="prefetch" href="/assets/js/27.180868e6.js"><link rel="prefetch" href="/assets/js/270.12a6e0db.js"><link rel="prefetch" href="/assets/js/271.15bf6cdf.js"><link rel="prefetch" href="/assets/js/272.61fbb4a9.js"><link rel="prefetch" href="/assets/js/273.f9791c77.js"><link rel="prefetch" href="/assets/js/274.5fd7dbec.js"><link rel="prefetch" href="/assets/js/275.7b98c86d.js"><link rel="prefetch" href="/assets/js/276.985733c7.js"><link rel="prefetch" href="/assets/js/277.00090ed0.js"><link rel="prefetch" href="/assets/js/278.3ceedc16.js"><link rel="prefetch" href="/assets/js/279.3e1c1cfc.js"><link rel="prefetch" href="/assets/js/28.339c11a7.js"><link rel="prefetch" href="/assets/js/280.94924e81.js"><link rel="prefetch" href="/assets/js/281.a02d172b.js"><link rel="prefetch" href="/assets/js/282.c19c7094.js"><link rel="prefetch" href="/assets/js/283.1b0ba9cb.js"><link rel="prefetch" href="/assets/js/284.ec878a6c.js"><link rel="prefetch" href="/assets/js/285.394ffa31.js"><link rel="prefetch" href="/assets/js/286.5bd63aec.js"><link rel="prefetch" href="/assets/js/287.3246bf4a.js"><link rel="prefetch" href="/assets/js/288.93b85d04.js"><link rel="prefetch" href="/assets/js/289.8ca5f550.js"><link rel="prefetch" href="/assets/js/29.5c0cd288.js"><link rel="prefetch" href="/assets/js/290.7b237d5c.js"><link rel="prefetch" href="/assets/js/291.ea8ab05c.js"><link rel="prefetch" href="/assets/js/292.3973d5a5.js"><link rel="prefetch" href="/assets/js/293.476236e6.js"><link rel="prefetch" href="/assets/js/294.219df76d.js"><link rel="prefetch" href="/assets/js/295.9b6a088c.js"><link rel="prefetch" href="/assets/js/296.9ca9ddfb.js"><link rel="prefetch" href="/assets/js/297.800e5259.js"><link rel="prefetch" href="/assets/js/298.5f6882d9.js"><link rel="prefetch" href="/assets/js/299.48a26893.js"><link rel="prefetch" href="/assets/js/3.b0999c95.js"><link rel="prefetch" href="/assets/js/30.a6ff75f8.js"><link rel="prefetch" href="/assets/js/300.96762618.js"><link rel="prefetch" href="/assets/js/301.2fdc8170.js"><link rel="prefetch" href="/assets/js/302.474a9577.js"><link rel="prefetch" href="/assets/js/303.bb70fdb7.js"><link rel="prefetch" href="/assets/js/304.43e2fd1c.js"><link rel="prefetch" href="/assets/js/305.3373c958.js"><link rel="prefetch" href="/assets/js/306.d6c38460.js"><link rel="prefetch" href="/assets/js/307.dd256942.js"><link rel="prefetch" href="/assets/js/308.adc055e1.js"><link rel="prefetch" href="/assets/js/309.3f20181f.js"><link rel="prefetch" href="/assets/js/31.a29ed265.js"><link rel="prefetch" href="/assets/js/310.07ba00c5.js"><link rel="prefetch" href="/assets/js/311.c114ed04.js"><link rel="prefetch" href="/assets/js/312.fc9bf712.js"><link rel="prefetch" href="/assets/js/313.d83d02eb.js"><link rel="prefetch" href="/assets/js/314.c705f7e1.js"><link rel="prefetch" href="/assets/js/315.10b12dd9.js"><link rel="prefetch" href="/assets/js/316.3cc6b55b.js"><link rel="prefetch" href="/assets/js/317.2c62de69.js"><link rel="prefetch" href="/assets/js/318.c455b6ad.js"><link rel="prefetch" href="/assets/js/319.9e6a28ce.js"><link rel="prefetch" href="/assets/js/32.80f5f353.js"><link rel="prefetch" href="/assets/js/320.d5751229.js"><link rel="prefetch" href="/assets/js/321.1d7cab47.js"><link rel="prefetch" href="/assets/js/322.d6cafb14.js"><link rel="prefetch" href="/assets/js/323.59c70b72.js"><link rel="prefetch" href="/assets/js/324.d5056a18.js"><link rel="prefetch" href="/assets/js/325.edf3da61.js"><link rel="prefetch" href="/assets/js/326.d8568c24.js"><link rel="prefetch" href="/assets/js/327.fb20c2b5.js"><link rel="prefetch" href="/assets/js/328.e017d7aa.js"><link rel="prefetch" href="/assets/js/329.f341a3f6.js"><link rel="prefetch" href="/assets/js/33.fe06faa8.js"><link rel="prefetch" href="/assets/js/330.685bd02d.js"><link rel="prefetch" href="/assets/js/331.4b2e2186.js"><link rel="prefetch" href="/assets/js/332.c1331632.js"><link rel="prefetch" href="/assets/js/333.85a2ec6d.js"><link rel="prefetch" href="/assets/js/334.f2deda70.js"><link rel="prefetch" href="/assets/js/335.ffb12bff.js"><link rel="prefetch" href="/assets/js/336.0f4ae65d.js"><link rel="prefetch" href="/assets/js/337.a557932d.js"><link rel="prefetch" href="/assets/js/338.46b00201.js"><link rel="prefetch" href="/assets/js/339.a1c6748b.js"><link rel="prefetch" href="/assets/js/34.247f526e.js"><link rel="prefetch" href="/assets/js/340.ca11ff1b.js"><link rel="prefetch" href="/assets/js/341.88683612.js"><link rel="prefetch" href="/assets/js/342.5592a00d.js"><link rel="prefetch" href="/assets/js/343.50b85739.js"><link rel="prefetch" href="/assets/js/344.63d22937.js"><link rel="prefetch" href="/assets/js/345.cc48373d.js"><link rel="prefetch" href="/assets/js/346.3073b314.js"><link rel="prefetch" href="/assets/js/347.8c153e29.js"><link rel="prefetch" href="/assets/js/348.9f63d376.js"><link rel="prefetch" href="/assets/js/349.0ab170ce.js"><link rel="prefetch" href="/assets/js/35.625cde41.js"><link rel="prefetch" href="/assets/js/350.58a3ed04.js"><link rel="prefetch" href="/assets/js/351.3bc883c7.js"><link rel="prefetch" href="/assets/js/352.02bb4ade.js"><link rel="prefetch" href="/assets/js/353.41d7bd4b.js"><link rel="prefetch" href="/assets/js/354.6811e095.js"><link rel="prefetch" href="/assets/js/355.6d7c951f.js"><link rel="prefetch" href="/assets/js/356.86694a46.js"><link rel="prefetch" href="/assets/js/357.4f30b833.js"><link rel="prefetch" href="/assets/js/358.cd886d19.js"><link rel="prefetch" href="/assets/js/359.092c9174.js"><link rel="prefetch" href="/assets/js/36.0d9a01b4.js"><link rel="prefetch" href="/assets/js/360.7dfe898b.js"><link rel="prefetch" href="/assets/js/361.ad847957.js"><link rel="prefetch" href="/assets/js/362.71b44d56.js"><link rel="prefetch" href="/assets/js/363.436fa35b.js"><link rel="prefetch" href="/assets/js/364.b381072f.js"><link rel="prefetch" href="/assets/js/365.8f68b591.js"><link rel="prefetch" href="/assets/js/366.9cfbbb22.js"><link rel="prefetch" href="/assets/js/367.a858864e.js"><link rel="prefetch" href="/assets/js/368.d588290d.js"><link rel="prefetch" href="/assets/js/369.5c95e220.js"><link rel="prefetch" href="/assets/js/37.a2eaac87.js"><link rel="prefetch" href="/assets/js/370.4b6b0fc5.js"><link rel="prefetch" href="/assets/js/371.c7c61fe4.js"><link rel="prefetch" href="/assets/js/372.7f9c56e4.js"><link rel="prefetch" href="/assets/js/373.52cd4bc3.js"><link rel="prefetch" href="/assets/js/374.6472f312.js"><link rel="prefetch" href="/assets/js/375.f14e3d47.js"><link rel="prefetch" href="/assets/js/376.6dd85637.js"><link rel="prefetch" href="/assets/js/377.7b4657d8.js"><link rel="prefetch" href="/assets/js/378.5cd48724.js"><link rel="prefetch" href="/assets/js/379.ea8b9913.js"><link rel="prefetch" href="/assets/js/38.39e356e9.js"><link rel="prefetch" href="/assets/js/380.87aa201e.js"><link rel="prefetch" href="/assets/js/381.9912a0a0.js"><link rel="prefetch" href="/assets/js/382.c28c04cf.js"><link rel="prefetch" href="/assets/js/383.b24eb794.js"><link rel="prefetch" href="/assets/js/384.ebc1ed91.js"><link rel="prefetch" href="/assets/js/385.7f59635a.js"><link rel="prefetch" href="/assets/js/386.8853e244.js"><link rel="prefetch" href="/assets/js/387.2a25b0cb.js"><link rel="prefetch" href="/assets/js/388.3ec36170.js"><link rel="prefetch" href="/assets/js/389.6f373646.js"><link rel="prefetch" href="/assets/js/39.f6ab8ed8.js"><link rel="prefetch" href="/assets/js/390.1acf1d49.js"><link rel="prefetch" href="/assets/js/391.8c716fb4.js"><link rel="prefetch" href="/assets/js/392.30e99f80.js"><link rel="prefetch" href="/assets/js/393.6d77a01b.js"><link rel="prefetch" href="/assets/js/394.9d0999cb.js"><link rel="prefetch" href="/assets/js/395.7823673d.js"><link rel="prefetch" href="/assets/js/396.09b4086c.js"><link rel="prefetch" href="/assets/js/397.c84bb99a.js"><link rel="prefetch" href="/assets/js/398.d5a3b316.js"><link rel="prefetch" href="/assets/js/399.4d2e9848.js"><link rel="prefetch" href="/assets/js/4.0e60897e.js"><link rel="prefetch" href="/assets/js/40.06a4077c.js"><link rel="prefetch" href="/assets/js/400.5f330dff.js"><link rel="prefetch" href="/assets/js/401.cb62db7a.js"><link rel="prefetch" href="/assets/js/402.05e4368e.js"><link rel="prefetch" href="/assets/js/403.97ed7ed7.js"><link rel="prefetch" href="/assets/js/404.eb16d4dd.js"><link rel="prefetch" href="/assets/js/405.80c54f11.js"><link rel="prefetch" href="/assets/js/406.86b0d585.js"><link rel="prefetch" href="/assets/js/407.a9bda3f2.js"><link rel="prefetch" href="/assets/js/408.88ca6d6f.js"><link rel="prefetch" href="/assets/js/409.35f4fa94.js"><link rel="prefetch" href="/assets/js/41.e1f61307.js"><link rel="prefetch" href="/assets/js/410.1e9c40cb.js"><link rel="prefetch" href="/assets/js/411.e9a01883.js"><link rel="prefetch" href="/assets/js/412.6b4cc2e3.js"><link rel="prefetch" href="/assets/js/413.fecdea7d.js"><link rel="prefetch" href="/assets/js/414.659257c2.js"><link rel="prefetch" href="/assets/js/415.8ff938b8.js"><link rel="prefetch" href="/assets/js/416.f1799eea.js"><link rel="prefetch" href="/assets/js/417.044be3e3.js"><link rel="prefetch" href="/assets/js/418.62fcc746.js"><link rel="prefetch" href="/assets/js/419.7125c777.js"><link rel="prefetch" href="/assets/js/42.3db3f9b2.js"><link rel="prefetch" href="/assets/js/420.e6620f12.js"><link rel="prefetch" href="/assets/js/421.d404590e.js"><link rel="prefetch" href="/assets/js/422.897afb59.js"><link rel="prefetch" href="/assets/js/423.96f50d78.js"><link rel="prefetch" href="/assets/js/424.29382d0e.js"><link rel="prefetch" href="/assets/js/425.66afa292.js"><link rel="prefetch" href="/assets/js/426.92568750.js"><link rel="prefetch" href="/assets/js/427.3ca4670a.js"><link rel="prefetch" href="/assets/js/428.8497a5bd.js"><link rel="prefetch" href="/assets/js/429.cb3ab7f8.js"><link rel="prefetch" href="/assets/js/43.6836a617.js"><link rel="prefetch" href="/assets/js/430.654a394d.js"><link rel="prefetch" href="/assets/js/431.775f37ad.js"><link rel="prefetch" href="/assets/js/432.99c8e42d.js"><link rel="prefetch" href="/assets/js/433.bfac4efb.js"><link rel="prefetch" href="/assets/js/434.030a69c5.js"><link rel="prefetch" href="/assets/js/435.fd4ef728.js"><link rel="prefetch" href="/assets/js/436.f6ec588d.js"><link rel="prefetch" href="/assets/js/437.06fbdb14.js"><link rel="prefetch" href="/assets/js/438.afed2fbf.js"><link rel="prefetch" href="/assets/js/439.53e86a96.js"><link rel="prefetch" href="/assets/js/44.574643f5.js"><link rel="prefetch" href="/assets/js/440.5e14b045.js"><link rel="prefetch" href="/assets/js/441.820cebb6.js"><link rel="prefetch" href="/assets/js/442.d11d086a.js"><link rel="prefetch" href="/assets/js/443.a2305aed.js"><link rel="prefetch" href="/assets/js/444.25485515.js"><link rel="prefetch" href="/assets/js/445.69308f4a.js"><link rel="prefetch" href="/assets/js/446.b4c65d97.js"><link rel="prefetch" href="/assets/js/447.9388c357.js"><link rel="prefetch" href="/assets/js/448.0391a555.js"><link rel="prefetch" href="/assets/js/449.3e502b7f.js"><link rel="prefetch" href="/assets/js/45.64ebbc6d.js"><link rel="prefetch" href="/assets/js/450.e4170521.js"><link rel="prefetch" href="/assets/js/451.18581977.js"><link rel="prefetch" href="/assets/js/452.3de895ca.js"><link rel="prefetch" href="/assets/js/453.35983cc7.js"><link rel="prefetch" href="/assets/js/454.1038a7ee.js"><link rel="prefetch" href="/assets/js/455.7a6cddf2.js"><link rel="prefetch" href="/assets/js/456.6d912b5f.js"><link rel="prefetch" href="/assets/js/457.dedf0770.js"><link rel="prefetch" href="/assets/js/458.896babdd.js"><link rel="prefetch" href="/assets/js/459.636ce30d.js"><link rel="prefetch" href="/assets/js/46.7439161f.js"><link rel="prefetch" href="/assets/js/461.4ac4f02c.js"><link rel="prefetch" href="/assets/js/462.24f57699.js"><link rel="prefetch" href="/assets/js/463.122800d1.js"><link rel="prefetch" href="/assets/js/464.717c391c.js"><link rel="prefetch" href="/assets/js/465.e19682c9.js"><link rel="prefetch" href="/assets/js/466.4119159d.js"><link rel="prefetch" href="/assets/js/467.c379908f.js"><link rel="prefetch" href="/assets/js/468.42059caa.js"><link rel="prefetch" href="/assets/js/469.ab8052a8.js"><link rel="prefetch" href="/assets/js/47.b0d9a28f.js"><link rel="prefetch" href="/assets/js/470.c8846893.js"><link rel="prefetch" href="/assets/js/471.33c17acb.js"><link rel="prefetch" href="/assets/js/472.879b43fb.js"><link rel="prefetch" href="/assets/js/473.cf73fcbb.js"><link rel="prefetch" href="/assets/js/474.41d3b68f.js"><link rel="prefetch" href="/assets/js/475.3f96c468.js"><link rel="prefetch" href="/assets/js/476.19159576.js"><link rel="prefetch" href="/assets/js/477.3f180bc0.js"><link rel="prefetch" href="/assets/js/478.d3d0059f.js"><link rel="prefetch" href="/assets/js/479.d7fce226.js"><link rel="prefetch" href="/assets/js/48.0f6055df.js"><link rel="prefetch" href="/assets/js/480.5cab8349.js"><link rel="prefetch" href="/assets/js/481.38f3b847.js"><link rel="prefetch" href="/assets/js/482.8c612ccb.js"><link rel="prefetch" href="/assets/js/483.0ebdf993.js"><link rel="prefetch" href="/assets/js/484.83103ece.js"><link rel="prefetch" href="/assets/js/485.9669431d.js"><link rel="prefetch" href="/assets/js/486.45187e09.js"><link rel="prefetch" href="/assets/js/487.ccaa8640.js"><link rel="prefetch" href="/assets/js/488.b2dd3055.js"><link rel="prefetch" href="/assets/js/489.c1146793.js"><link rel="prefetch" href="/assets/js/49.a7f24c83.js"><link rel="prefetch" href="/assets/js/490.239d56df.js"><link rel="prefetch" href="/assets/js/491.0ec5a2e6.js"><link rel="prefetch" href="/assets/js/492.8bf8dff8.js"><link rel="prefetch" href="/assets/js/493.68d5f082.js"><link rel="prefetch" href="/assets/js/494.fdef18fd.js"><link rel="prefetch" href="/assets/js/5.b553833b.js"><link rel="prefetch" href="/assets/js/50.fb734d94.js"><link rel="prefetch" href="/assets/js/51.d7458c94.js"><link rel="prefetch" href="/assets/js/52.1ba49201.js"><link rel="prefetch" href="/assets/js/53.9822bfb4.js"><link rel="prefetch" href="/assets/js/54.0d0b2de4.js"><link rel="prefetch" href="/assets/js/55.62467521.js"><link rel="prefetch" href="/assets/js/56.fe6cda53.js"><link rel="prefetch" href="/assets/js/57.9f146707.js"><link rel="prefetch" href="/assets/js/58.17b96917.js"><link rel="prefetch" href="/assets/js/59.79f271e5.js"><link rel="prefetch" href="/assets/js/6.c4f19222.js"><link rel="prefetch" href="/assets/js/60.75c1128e.js"><link rel="prefetch" href="/assets/js/61.cbe9a6f0.js"><link rel="prefetch" href="/assets/js/62.30a2817d.js"><link rel="prefetch" href="/assets/js/63.12838005.js"><link rel="prefetch" href="/assets/js/64.3f3d7f46.js"><link rel="prefetch" href="/assets/js/65.a2d551a0.js"><link rel="prefetch" href="/assets/js/66.1fe7de46.js"><link rel="prefetch" href="/assets/js/67.7386f21d.js"><link rel="prefetch" href="/assets/js/68.fbc638ae.js"><link rel="prefetch" href="/assets/js/69.24ef14d8.js"><link rel="prefetch" href="/assets/js/7.2108f1a9.js"><link rel="prefetch" href="/assets/js/70.3085318f.js"><link rel="prefetch" href="/assets/js/71.2a9d6c13.js"><link rel="prefetch" href="/assets/js/72.8d987add.js"><link rel="prefetch" href="/assets/js/73.eeb114c6.js"><link rel="prefetch" href="/assets/js/74.700c9194.js"><link rel="prefetch" href="/assets/js/75.de433090.js"><link rel="prefetch" href="/assets/js/76.559a4ec7.js"><link rel="prefetch" href="/assets/js/77.7da7e4ed.js"><link rel="prefetch" href="/assets/js/78.76cdf844.js"><link rel="prefetch" href="/assets/js/79.bb387556.js"><link rel="prefetch" href="/assets/js/8.0e3c03b6.js"><link rel="prefetch" href="/assets/js/80.cced463e.js"><link rel="prefetch" href="/assets/js/81.2eda55cd.js"><link rel="prefetch" href="/assets/js/82.d4363e9b.js"><link rel="prefetch" href="/assets/js/83.f6acc01a.js"><link rel="prefetch" href="/assets/js/84.885bdd16.js"><link rel="prefetch" href="/assets/js/85.d2a50185.js"><link rel="prefetch" href="/assets/js/86.4f6cdab1.js"><link rel="prefetch" href="/assets/js/87.ece1d73d.js"><link rel="prefetch" href="/assets/js/88.b9a26b2d.js"><link rel="prefetch" href="/assets/js/89.e69c0dbe.js"><link rel="prefetch" href="/assets/js/9.21d1b00b.js"><link rel="prefetch" href="/assets/js/90.5aecf157.js"><link rel="prefetch" href="/assets/js/91.d24c5813.js"><link rel="prefetch" href="/assets/js/92.3a8634c1.js"><link rel="prefetch" href="/assets/js/93.ea73a496.js"><link rel="prefetch" href="/assets/js/94.e9826970.js"><link rel="prefetch" href="/assets/js/95.396c386e.js"><link rel="prefetch" href="/assets/js/96.861721d5.js"><link rel="prefetch" href="/assets/js/97.c839a5f1.js"><link rel="prefetch" href="/assets/js/98.981eddb7.js"><link rel="prefetch" href="/assets/js/99.9049d080.js">
    <link rel="stylesheet" href="/assets/css/0.styles.84c1e0ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/common/unification_logoblack.png" alt="Documentation" class="logo"> <span class="site-name can-hide">Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mainchain/" class="nav-link router-link-active">
  Mainchain
</a></div><div class="nav-item"><a href="/vor/" class="nav-link">
  VOR
</a></div><div class="nav-item"><a href="/ooo/" class="nav-link">
  OoO
</a></div><div class="nav-item"><a href="/unode/" class="nav-link">
  UNoDE
</a></div> <a href="https://github.com/unification-com/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mainchain/" class="nav-link router-link-active">
  Mainchain
</a></div><div class="nav-item"><a href="/vor/" class="nav-link">
  VOR
</a></div><div class="nav-item"><a href="/ooo/" class="nav-link">
  OoO
</a></div><div class="nav-item"><a href="/unode/" class="nav-link">
  UNoDE
</a></div> <a href="https://github.com/unification-com/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Software</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Migrations &amp; Upgrades</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Networks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Validators</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Delegators</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>IBC Transfers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Payment Streams</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mainchain/streams/ui.html" class="sidebar-link">Payment Streams UI</a></li><li><a href="/mainchain/streams/cli.html" class="sidebar-link">und CLI</a></li><li><a href="/mainchain/streams/developer-guide-fundjs.html" aria-current="page" class="active sidebar-link">Developer Guide: fundjs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mainchain/streams/developer-guide-fundjs.html#dependencies" class="sidebar-link">Dependencies</a></li><li class="sidebar-sub-header"><a href="/mainchain/streams/developer-guide-fundjs.html#querying" class="sidebar-link">Querying</a></li><li class="sidebar-sub-header"><a href="/mainchain/streams/developer-guide-fundjs.html#creating-broadcasting-txs" class="sidebar-link">Creating &amp; Broadcasting Txs</a></li><li class="sidebar-sub-header"><a href="/mainchain/streams/developer-guide-fundjs.html#monitoring-with-websockets" class="sidebar-link">Monitoring with Websockets</a></li></ul></li><li><a href="/mainchain/streams/developer-guide-react.html" class="sidebar-link">Developer Guide: React Hooks</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Tx &amp; Query Examples</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Guides</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Developers</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="developer-guide-fundjs"><a href="#developer-guide-fundjs" class="header-anchor">#</a> Developer Guide: <code>fundjs</code></h1> <p>The <code>fundjs</code> library contains all the required methods to create, manage and query <strong>Payment Streams</strong>.
This guide outlines each of the methods, and how to implement and use them.</p> <h2 id="dependencies"><a href="#dependencies" class="header-anchor">#</a> Dependencies</h2> <p>NodeJS &gt;= <code>v18.20</code> is recommended.</p> <p>Install the <code>fundjs</code> library:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> @unification-com/fundjs
</code></pre></div><p>Or with Yarn:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> @unification-com/fundjs
</code></pre></div><p>For creating signing and broadcasting transactions, some additional dependencies are required:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> @cosmjs/amino@0.32.4 @cosmjs/crypto@0.32.4 @cosmjs/proto-signing@0.32.4 @cosmjs/stargate@0.32.4 cosmjs-utils@0.1.0
</code></pre></div><p>Or with Yarn:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> @cosmjs/amino@0.32.4 @cosmjs/crypto@0.32.4 @cosmjs/proto-signing@0.32.4 @cosmjs/stargate@0.32.4 cosmjs-utils@0.1.0
</code></pre></div><h2 id="querying"><a href="#querying" class="header-anchor">#</a> Querying</h2> <h3 id="create-a-client"><a href="#create-a-client" class="header-anchor">#</a> Create a Client</h3> <p>First, a <code>mainchain</code> client is required for querying the chain. Both RPC and LCD clients are available in <code>fundjs</code>.
For the purposes of this guide, the RPC client will be used.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mainchain <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@unification-com/fundjs'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> createRPCQueryClient <span class="token punctuation">}</span> <span class="token operator">=</span> mainchain<span class="token punctuation">.</span>ClientFactory
<span class="token keyword">const</span> <span class="token constant">RPC_ENDPOINT</span> <span class="token operator">=</span> <span class="token string">&quot;http://localhost:26657&quot;</span>
<span class="token keyword">const</span> <span class="token constant">SENDER_ADDR</span> <span class="token operator">=</span> <span class="token string">&quot;und1sc4wry4kwypu4ddj9nme70dw3ka6wyhv7sc3vx&quot;</span>
<span class="token keyword">const</span> <span class="token constant">RECEIVER_ADDR</span> <span class="token operator">=</span> <span class="token string">&quot;und17tc3wwr8ksz5tzgl2t4wmpdmaxx0pn7vvz8j3h&quot;</span>

<span class="token comment">// create a query client</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createMainchainRPCQueryClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">rpcEndpoint</span><span class="token operator">:</span> <span class="token constant">RPC_ENDPOINT</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="params"><a href="#params" class="header-anchor">#</a> params</h3> <p>The on-chain parameters can be queried using the <code>params</code> method</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">params</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>The returned JSON is transformed into a Javascript object, e.g.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> 
  <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">validatorFee</span><span class="token operator">:</span> <span class="token string">&quot;0.01&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="calculateflowrate"><a href="#calculateflowrate" class="header-anchor">#</a> calculateFlowRate</h3> <p>The <code>calculateFlowRate</code> allows you to pass data regarding a stream, and returns the flow rate required to create or
update a stream.</p> <p>The following parameters are required to be passed as a <code>QueryCalculateFlowRateRequest</code> type:</p> <ul><li><strong>coin</strong>: (string) the amount being sent, in the lowest denomination, e.g. <code>100000000000nund</code></li> <li><strong>period</strong>: (integer) the time period a stream should be valid for. For example, month, week, hour etc.
<ul><li>second: <code>mainchain.stream.v1.StreamPeriod.STREAM_PERIOD_SECOND</code></li> <li>minute: <code>mainchain.stream.v1.StreamPeriod.STREAM_PERIOD_MINUTE</code></li> <li>hour: <code>mainchain.stream.v1.StreamPeriod.STREAM_PERIOD_HOUR</code></li> <li>day: <code>mainchain.stream.v1.StreamPeriod.STREAM_PERIOD_DAY</code></li> <li>week: <code>mainchain.stream.v1.StreamPeriod.STREAM_PERIOD_WEEK</code></li> <li>month: <code>mainchain.stream.v1.StreamPeriod.STREAM_PERIOD_MONTH</code></li> <li>year: <code>mainchain.stream.v1.StreamPeriod.STREAM_PERIOD_YEAR</code></li></ul></li> <li><strong>duration</strong>: (integer) the number of time periods, e.g. 1, 2 etc.</li></ul> <p>For example, a monthly payment of 100 FUND would be represented as:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> flowRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">coin</span><span class="token operator">:</span> <span class="token string">&quot;100000000000nund&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">period</span><span class="token operator">:</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>StreamPeriod<span class="token punctuation">.</span><span class="token constant">STREAM_PERIOD_MONTH</span><span class="token punctuation">,</span>
  <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>100 FUND paid every two weeks would be:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> flowRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">coin</span><span class="token operator">:</span> <span class="token string">&quot;100000000000nund&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">period</span><span class="token operator">:</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>StreamPeriod<span class="token punctuation">.</span><span class="token constant">STREAM_PERIOD_WEEK</span><span class="token punctuation">,</span>
  <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The request parameters are passed to <code>calculateFlowRate</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> flowRateRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">calculateFlowRate</span><span class="token punctuation">(</span>flowRequest<span class="token punctuation">)</span>
</code></pre></div><p>A Javascript object is returned, for example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">coin</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
    <span class="token literal-property property">denom</span><span class="token operator">:</span> <span class="token string">'nund'</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token string">'100000000000'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">period</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
  <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">seconds</span><span class="token operator">:</span> <span class="token number">2628000</span><span class="token punctuation">,</span>
  <span class="token literal-property property">flowRate</span><span class="token operator">:</span> <span class="token number">38051</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>flowRate</code> can then be in the <code>createStream</code> Msg type.</p> <h3 id="streams"><a href="#streams" class="header-anchor">#</a> streams</h3> <p>All streams can be queried using the <code>streams</code> method. The only request parameter it accepts is the optional <code>cosmosjs</code>
pagination type <code>PageRequest</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> allStreamsRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">streams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre></div><h3 id="allstreamsforreceiver"><a href="#allstreamsforreceiver" class="header-anchor">#</a> allStreamsForReceiver</h3> <p>Streams can be filtered by the receiver wallet address using the <code>allStreamsForReceiver</code> method. The
<code>QueryAllStreamsForReceiverRequest</code> type is expected to be passed, containing the receiver wallet address, and the
option <code>cosmosjs</code> pagination type <code>PageRequest</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> receiverReq <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">receiverAddr</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token comment">// pagination: {}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The request object is then passed to <code>allStreamsForReceiver</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> receiverStreamsRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">allStreamsForReceiver</span><span class="token punctuation">(</span>receiverReq<span class="token punctuation">)</span>
</code></pre></div><h3 id="allstreamsforsender"><a href="#allstreamsforsender" class="header-anchor">#</a> allStreamsForSender</h3> <p>Streams can be filtered by the sender wallet address using the <code>allStreamsForSender</code> method. The
<code>QueryAllStreamsForSenderRequest</code> type is expected to be passed, containing the receiver wallet address, and the
option <code>cosmosjs</code> pagination type <code>PageRequest</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> senderReq <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">senderAddr</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
  <span class="token comment">// pagination: {}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The request object is then passed to <code>allStreamsForSender</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> senderStreamsRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">allStreamsForSender</span><span class="token punctuation">(</span>receiverReq<span class="token punctuation">)</span>
</code></pre></div><h3 id="streambyreceiversender"><a href="#streambyreceiversender" class="header-anchor">#</a> streamByReceiverSender</h3> <p>The <code>streamByReceiverSender</code> method allows querying streams for given sender and receiver wallet addresses. If a stream
between the two wallets exists, it will be returned</p> <p>The <code>QueryStreamByReceiverSenderRequest</code> type containing the sender and receiver wallet addresses is passed to the
method:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> sendRecReq <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">receiverAddr</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token literal-property property">senderAddr</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> streamRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">streamByReceiverSender</span><span class="token punctuation">(</span>sendRecReq<span class="token punctuation">)</span>

</code></pre></div><h3 id="streamreceiversendercurrentflow"><a href="#streamreceiversendercurrentflow" class="header-anchor">#</a> streamReceiverSenderCurrentFlow</h3> <p>The current and configured flow rate for a particular stream between two wallets can be queried using the
<code>streamReceiverSenderCurrentFlow</code> method. This is useful for checking if a stream is currently active, or if it
has expired (deposit depleted to zero).</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> streamFlowRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">streamReceiverSenderCurrentFlow</span><span class="token punctuation">(</span>sendRecReq<span class="token punctuation">)</span>
</code></pre></div><p>The returned result contains two values:</p> <ol><li><code>configuredFlowRate</code>: The configured flow rate when the stream is active (i.e. it has funds deposited, and has not expired)</li> <li><code>currentFlowRate</code>: the actual current flow rate. For active streams this will be a positive, non-zero integer.
Inactive, expired or streams with zero deposit will have this value set to <code>0</code></li></ol> <p>For example, the following result shows that a stream is configured to send 100 FUND per month, but is currently
expired/inactive due to the deposit being zero</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> 
  <span class="token literal-property property">configuredFlowRate</span><span class="token operator">:</span> <span class="token number">38051n</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">currentFlowRate</span><span class="token operator">:</span> <span class="token number">0n</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>As soon as the stream is topped up and FUND deposited, the result would be:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> 
  <span class="token literal-property property">configuredFlowRate</span><span class="token operator">:</span> <span class="token number">38051n</span><span class="token punctuation">,</span> 
  <span class="token literal-property property">currentFlowRate</span><span class="token operator">:</span> <span class="token number">38051n</span> 
<span class="token punctuation">}</span>
</code></pre></div><h3 id="putting-it-together"><a href="#putting-it-together" class="header-anchor">#</a> Putting it together</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// queries.mjs</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> mainchain <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@unification-com/fundjs'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> createRPCQueryClient <span class="token punctuation">}</span> <span class="token operator">=</span> mainchain<span class="token punctuation">.</span>ClientFactory

<span class="token keyword">const</span> <span class="token constant">RPC_ENDPOINT</span> <span class="token operator">=</span> <span class="token string">&quot;http://localhost:26657&quot;</span>
<span class="token keyword">const</span> <span class="token constant">SENDER_ADDR</span> <span class="token operator">=</span> <span class="token string">&quot;und1sc4wry4kwypu4ddj9nme70dw3ka6wyhv7sc3vx&quot;</span>
<span class="token keyword">const</span> <span class="token constant">RECEIVER_ADDR</span> <span class="token operator">=</span> <span class="token string">&quot;und17tc3wwr8ksz5tzgl2t4wmpdmaxx0pn7vvz8j3h&quot;</span>

<span class="token comment">// create client</span>
<span class="token keyword">const</span> queryClient <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createRPCQueryClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">rpcEndpoint</span><span class="token operator">:</span> <span class="token constant">RPC_ENDPOINT</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// get the module params</span>
<span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">params</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>

<span class="token comment">// calculate flow rate for 100 FUND/month</span>
<span class="token keyword">const</span> flowRequest <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">coin</span><span class="token operator">:</span> <span class="token string">&quot;100000000000nund&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">period</span><span class="token operator">:</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>StreamPeriod<span class="token punctuation">.</span><span class="token constant">STREAM_PERIOD_MONTH</span><span class="token punctuation">,</span>
  <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> flowRateRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">calculateFlowRate</span><span class="token punctuation">(</span>flowRequest<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>flowRateRes<span class="token punctuation">)</span>

<span class="token comment">// get all streams</span>
<span class="token keyword">const</span> allStreamsRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">streams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>allStreamsRes<span class="token punctuation">)</span>

<span class="token comment">// get all streams for receiver</span>
<span class="token keyword">const</span> receiverReq <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">receiverAddr</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token comment">// pagination: {}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> receiverStreamsRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">allStreamsForReceiver</span><span class="token punctuation">(</span>receiverReq<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>receiverStreamsRes<span class="token punctuation">)</span>

<span class="token comment">// get all streams for sender</span>
<span class="token keyword">const</span> senderReq <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">senderAddr</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
  <span class="token comment">// pagination: {}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> senderStreamsRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">allStreamsForSender</span><span class="token punctuation">(</span>senderReq<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>senderStreamsRes<span class="token punctuation">)</span>

<span class="token comment">// get a single stream between a sender and receiver</span>
<span class="token keyword">const</span> sendRecReq <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">receiverAddr</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token literal-property property">senderAddr</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> streamRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">streamByReceiverSender</span><span class="token punctuation">(</span>sendRecReq<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>streamRes<span class="token punctuation">)</span>

<span class="token comment">// get the current flow rate/chec if the stream is active</span>
<span class="token keyword">const</span> streamFlowRes <span class="token operator">=</span> <span class="token keyword">await</span> queryClient<span class="token punctuation">.</span>mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span><span class="token function">streamReceiverSenderCurrentFlow</span><span class="token punctuation">(</span>sendRecReq<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>streamFlowRes<span class="token punctuation">)</span>
</code></pre></div><h2 id="creating-broadcasting-txs"><a href="#creating-broadcasting-txs" class="header-anchor">#</a> Creating &amp; Broadcasting Txs</h2> <p>The <code>fundjs</code> library contains all the required Msg types to create and manage Payment Streams programmatically. Each
method can be imported in order to generate the desired Msg type, which can then be packed into a standard Cosmos Tx,
signed and broadcast using the methods available with <code>@cosmjs/stargate</code>.</p> <h3 id="create-a-signer-signing-client"><a href="#create-a-signer-signing-client" class="header-anchor">#</a> Create a Signer &amp; Signing Client</h3> <p>In addition to the RPC client, a signer is required so that a private key can be used to sign and broadcast
transactions to the Unification network.</p> <p>For this, a simple function can be created, to which a Mnemonic, chain data and account number can be passed. It will
return a <code>Secp256k1HdWallet</code> wallet that can be used to sign transactions</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>Secp256k1HdWallet<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@cosmjs/amino'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>makeHdPath<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cosmjs-utils'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getOfflineSignerAmino</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mnemonic<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> account <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      bech32_prefix<span class="token punctuation">,</span>
      slip44
    <span class="token punctuation">}</span> <span class="token operator">=</span> chain<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">await</span> Secp256k1HdWallet<span class="token punctuation">.</span><span class="token function">fromMnemonic</span><span class="token punctuation">(</span>mnemonic<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">prefix</span><span class="token operator">:</span> bech32_prefix<span class="token punctuation">,</span>
        <span class="token literal-property property">hdPaths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">makeHdPath</span><span class="token punctuation">(</span>slip44<span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bad mnemonic'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Using the <code>getOfflineSignerAmino</code> function, a signer can be created, for example</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">MNEMONIC</span> <span class="token operator">=</span> <span class="token string">&quot;my wallet seed phrase...&quot;</span>

<span class="token comment">// parameters to create a wallet with HD path m44'/5555'/0'/0 and account index 0</span>
<span class="token keyword">const</span> signerParams <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mnemonic</span><span class="token operator">:</span> <span class="token constant">MNEMONIC</span><span class="token punctuation">,</span>
  <span class="token literal-property property">chain</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">bech32_prefix</span><span class="token operator">:</span> <span class="token string">&quot;und&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Bech32 prefix, e.g. &quot;und&quot; for Unification</span>
    <span class="token literal-property property">slip44</span><span class="token operator">:</span> <span class="token number">5555</span><span class="token punctuation">,</span> <span class="token comment">// for the HD wallet path</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">account</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// array index of the account used to sign. Used in the HD path</span>
<span class="token punctuation">}</span> 

<span class="token keyword">const</span> signer <span class="token operator">=</span> <span class="token function">getOfflineSignerAmino</span><span class="token punctuation">(</span>signerParams<span class="token punctuation">)</span>
</code></pre></div><p>Once a signer has been created, a signing client can be initialised. The Amino convertors and Proto registries need to
be imported from <code>fundjs</code>, and passed to <code>@cosmjs/proto-signing</code> and <code>@cosmjs/stargate</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Registry <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@cosmjs/proto-signing&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AminoTypes<span class="token punctuation">,</span> SigningStargateClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@cosmjs/stargate&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  cosmosAminoConverters<span class="token punctuation">,</span>
  cosmosProtoRegistry<span class="token punctuation">,</span>
  ibcProtoRegistry<span class="token punctuation">,</span>
  ibcAminoConverters<span class="token punctuation">,</span>
  mainchainAminoConverters<span class="token punctuation">,</span>
  mainchainProtoRegistry
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@unification-com/fundjs'</span><span class="token punctuation">;</span>

<span class="token comment">// include cosmos, ibc and mainchain</span>
<span class="token keyword">const</span> protoRegistry <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">...</span>cosmosProtoRegistry<span class="token punctuation">,</span>
  <span class="token operator">...</span>ibcProtoRegistry<span class="token punctuation">,</span>
  <span class="token operator">...</span>mainchainProtoRegistry
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> aminoConverters <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>cosmosAminoConverters<span class="token punctuation">,</span>
  <span class="token operator">...</span>ibcAminoConverters<span class="token punctuation">,</span>
  <span class="token operator">...</span>mainchainAminoConverters
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> registry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Registry</span><span class="token punctuation">(</span>protoRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> aminoTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AminoTypes</span><span class="token punctuation">(</span>aminoConverters<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Once these are created, the signing client can be spawned</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">RPC_ENDPOINT</span> <span class="token operator">=</span> <span class="token string">&quot;http://localhost:26657&quot;</span>
<span class="token comment">// create client with signer containing all codecs for cosmos, mainchain and ibc</span>
<span class="token comment">// signer is from getOfflineSignerAmino</span>
<span class="token keyword">const</span> signingClient <span class="token operator">=</span> <span class="token keyword">await</span> SigningStargateClient<span class="token punctuation">.</span><span class="token function">connectWithSigner</span><span class="token punctuation">(</span><span class="token constant">RPC_ENDPOINT</span><span class="token punctuation">,</span> signer<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  registry<span class="token punctuation">,</span>
  aminoTypes
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="dependencies-2"><a href="#dependencies-2" class="header-anchor">#</a> Dependencies</h3> <p>In order to generate Msgs, first import the <code>mainchain</code> module from <code>@unification-com/fundjs</code>, so that the
<code>MessageComposer</code> can be called and used</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Note: fundjs also includes all cosmos and ibc Msg types, which can be imported here too if required</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mainchain <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@unification-com/fundjs'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="createstream"><a href="#createstream" class="header-anchor">#</a> createStream</h3> <p>The <code>createStream</code> Msg requires a deposit amount, flow rate, sender address (must be the address of the wallet signing
the transaction), and the receiver wallet address</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">const</span> <span class="token constant">SENDER_ADDR</span> <span class="token operator">=</span> <span class="token string">&quot;und1sc4wry4kwypu4ddj9nme70dw3ka6wyhv7sc3vx&quot;</span>
<span class="token keyword">const</span> <span class="token constant">RECEIVER_ADDR</span> <span class="token operator">=</span> <span class="token string">&quot;und17tc3wwr8ksz5tzgl2t4wmpdmaxx0pn7vvz8j3h&quot;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> createStream <span class="token punctuation">}</span> <span class="token operator">=</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>MessageComposer<span class="token punctuation">.</span>withTypeUrl<span class="token punctuation">;</span>

<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">createStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">deposit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">denom</span><span class="token operator">:</span> <span class="token string">'nund'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token string">'100000000000'</span><span class="token punctuation">,</span> <span class="token comment">// initial deposit of 100 FUND, for 1 month. Can be topped up once stream is created</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">flowRate</span><span class="token operator">:</span> <span class="token string">'38051'</span><span class="token punctuation">,</span> <span class="token comment">// 100 FUND per month</span>
  <span class="token literal-property property">receiver</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sender</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="claimstream"><a href="#claimstream" class="header-anchor">#</a> claimStream</h3> <p>The <code>claimStream</code> Msg can be sent by a receiving wallet at any time to withdraw from a stream</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> claimStream <span class="token punctuation">}</span> <span class="token operator">=</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>MessageComposer<span class="token punctuation">.</span>withTypeUrl<span class="token punctuation">;</span>

<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">claimStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">receiver</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sender</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="topupdeposit"><a href="#topupdeposit" class="header-anchor">#</a> topUpDeposit</h3> <p>A stream sender (the creator) can add funds to the stream to keep it active and continue payments to the receiver (for
example, renewing a subscription)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> topUpDeposit <span class="token punctuation">}</span> <span class="token operator">=</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>MessageComposer<span class="token punctuation">.</span>withTypeUrl<span class="token punctuation">;</span>

<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">topUpDeposit</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">deposit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">denom</span><span class="token operator">:</span> <span class="token string">'nund'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token string">'100000000000'</span><span class="token punctuation">,</span> <span class="token comment">// deposit of 100 FUND</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">receiver</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sender</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="updateflowrate"><a href="#updateflowrate" class="header-anchor">#</a> updateFlowRate</h3> <p>A stream sender may also modify the flow rate at any time (for example, to change a subscription tier)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> updateFlowRate <span class="token punctuation">}</span> <span class="token operator">=</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>MessageComposer<span class="token punctuation">.</span>withTypeUrl<span class="token punctuation">;</span>

<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">updateFlowRate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">flowRate</span><span class="token operator">:</span> <span class="token string">'76103'</span><span class="token punctuation">,</span> <span class="token comment">// modify to 200 FUND per month</span>
  <span class="token literal-property property">receiver</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sender</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="cancelstream"><a href="#cancelstream" class="header-anchor">#</a> cancelStream</h3> <p>Finally, the sender (stream creator) can cancel a stream at any time with the <code>cancelStream</code> Msg</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> cancelStream <span class="token punctuation">}</span> <span class="token operator">=</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>MessageComposer<span class="token punctuation">.</span>withTypeUrl<span class="token punctuation">;</span>

<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">cancelStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">receiver</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sender</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fees"><a href="#fees" class="header-anchor">#</a> fees</h3> <p>A standard <code>cosmosjs</code> &quot;<code>fee</code>&quot; object can be created and passed to the signing client</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fee <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">denom</span><span class="token operator">:</span> <span class="token string">'nund'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token string">'50000000'</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">gas</span><span class="token operator">:</span> <span class="token string">'2000000'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="sign-and-broadcast"><a href="#sign-and-broadcast" class="header-anchor">#</a> Sign and broadcast</h3> <p>Any of the generated messages above can be signed and broadcast using the <code>signingClient</code> created previously. The
signing wallet address, array of <code>Msgs</code> and the <code>fee</code> are passed to <code>signAndBroadcast</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> signingClient<span class="token punctuation">.</span><span class="token function">signAndBroadcast</span><span class="token punctuation">(</span><span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>msg<span class="token punctuation">]</span><span class="token punctuation">,</span> fee<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
</code></pre></div><h3 id="putting-it-together-2"><a href="#putting-it-together-2" class="header-anchor">#</a> Putting it together</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// sign_broadcast.mjs</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Secp256k1HdWallet <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@cosmjs/amino'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> makeHdPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cosmjs-utils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Registry <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@cosmjs/proto-signing&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AminoTypes<span class="token punctuation">,</span> SigningStargateClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@cosmjs/stargate&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
  mainchain<span class="token punctuation">,</span>
  cosmosAminoConverters<span class="token punctuation">,</span>
  cosmosProtoRegistry<span class="token punctuation">,</span>
  ibcProtoRegistry<span class="token punctuation">,</span>
  ibcAminoConverters<span class="token punctuation">,</span>
  mainchainAminoConverters<span class="token punctuation">,</span>
  mainchainProtoRegistry
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@unification-com/fundjs'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">MNEMONIC</span> <span class="token operator">=</span> <span class="token string">&quot;my wallet seed phrase...&quot;</span>
<span class="token keyword">const</span> <span class="token constant">RPC_ENDPOINT</span> <span class="token operator">=</span> <span class="token string">&quot;http://localhost:26657&quot;</span>
<span class="token keyword">const</span> <span class="token constant">SENDER_ADDR</span> <span class="token operator">=</span> <span class="token string">&quot;und1sc4wry4kwypu4ddj9nme70dw3ka6wyhv7sc3vx&quot;</span>
<span class="token keyword">const</span> <span class="token constant">RECEIVER_ADDR</span> <span class="token operator">=</span> <span class="token string">&quot;und17tc3wwr8ksz5tzgl2t4wmpdmaxx0pn7vvz8j3h&quot;</span>

<span class="token comment">// include cosmos, ibc and mainchain</span>
<span class="token keyword">const</span> protoRegistry <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token operator">...</span>cosmosProtoRegistry<span class="token punctuation">,</span>
  <span class="token operator">...</span>ibcProtoRegistry<span class="token punctuation">,</span>
  <span class="token operator">...</span>mainchainProtoRegistry
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> aminoConverters <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>cosmosAminoConverters<span class="token punctuation">,</span>
  <span class="token operator">...</span>ibcAminoConverters<span class="token punctuation">,</span>
  <span class="token operator">...</span>mainchainAminoConverters
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// register protos and amino converters</span>
<span class="token keyword">const</span> registry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Registry</span><span class="token punctuation">(</span>protoRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> aminoTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AminoTypes</span><span class="token punctuation">(</span>aminoConverters<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// getOfflineSignerAmino accepts a Mnemonic, chain info and account number and returns a signer</span>
<span class="token keyword">const</span> <span class="token function-variable function">getOfflineSignerAmino</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mnemonic<span class="token punctuation">,</span> chain<span class="token punctuation">,</span> account <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>
      bech32_prefix<span class="token punctuation">,</span>
      slip44
    <span class="token punctuation">}</span> <span class="token operator">=</span> chain<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Secp256k1HdWallet<span class="token punctuation">.</span><span class="token function">fromMnemonic</span><span class="token punctuation">(</span>mnemonic<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">prefix</span><span class="token operator">:</span> bech32_prefix<span class="token punctuation">,</span>
      <span class="token literal-property property">hdPaths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">makeHdPath</span><span class="token punctuation">(</span>slip44<span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bad mnemonic'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// parameters to create a wallet with HD path m44'/5555'/0'/0 and account index 0</span>
<span class="token keyword">const</span> signerParams <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">mnemonic</span><span class="token operator">:</span> <span class="token constant">MNEMONIC</span><span class="token punctuation">,</span>
  <span class="token literal-property property">chain</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">bech32_prefix</span><span class="token operator">:</span> <span class="token string">&quot;und&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Bech32 prefix, e.g. &quot;und&quot; for Unification</span>
    <span class="token literal-property property">slip44</span><span class="token operator">:</span> <span class="token number">5555</span><span class="token punctuation">,</span> <span class="token comment">// for the HD wallet path</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">account</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// array index of the account used to sign. Used in the HD path</span>
<span class="token punctuation">}</span>

<span class="token comment">// create the signer using the above params</span>
<span class="token keyword">const</span> signer <span class="token operator">=</span> <span class="token function">getOfflineSignerAmino</span><span class="token punctuation">(</span>signerParams<span class="token punctuation">)</span>

<span class="token comment">// create client with signer containing all codecs for cosmos, mainchain and ibc,</span>
<span class="token comment">// passing the RPC endpoint and the signer created above</span>
<span class="token keyword">const</span> signingClient <span class="token operator">=</span> <span class="token keyword">await</span> SigningStargateClient<span class="token punctuation">.</span><span class="token function">connectWithSigner</span><span class="token punctuation">(</span><span class="token constant">RPC_ENDPOINT</span><span class="token punctuation">,</span> signer<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  registry<span class="token punctuation">,</span>
  aminoTypes
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// generate Msg to create a new stream</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> createStream <span class="token punctuation">}</span> <span class="token operator">=</span> mainchain<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>v1<span class="token punctuation">.</span>MessageComposer<span class="token punctuation">.</span>withTypeUrl<span class="token punctuation">;</span>

<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">createStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">deposit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">denom</span><span class="token operator">:</span> <span class="token string">'nund'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token string">'100000000000'</span><span class="token punctuation">,</span> <span class="token comment">// initial deposit of 100 FUND, for 1 month. Can be topped up once stream is created</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">flowRate</span><span class="token operator">:</span> <span class="token string">'38051'</span><span class="token punctuation">,</span> <span class="token comment">// 100 FUND per month</span>
  <span class="token literal-property property">receiver</span><span class="token operator">:</span> <span class="token constant">RECEIVER_ADDR</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sender</span><span class="token operator">:</span> <span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Set network fees and gas</span>
<span class="token keyword">const</span> fee <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">denom</span><span class="token operator">:</span> <span class="token string">'nund'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">amount</span><span class="token operator">:</span> <span class="token string">'50000000'</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">gas</span><span class="token operator">:</span> <span class="token string">'2000000'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// sign and broadcast the transaction</span>
<span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> signingClient<span class="token punctuation">.</span><span class="token function">signAndBroadcast</span><span class="token punctuation">(</span><span class="token constant">SENDER_ADDR</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>msg<span class="token punctuation">]</span><span class="token punctuation">,</span> fee<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// dump the response to console</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
</code></pre></div><h2 id="monitoring-with-websockets"><a href="#monitoring-with-websockets" class="header-anchor">#</a> Monitoring with Websockets</h2> <p>A very simple implementation for monitoring Payment Streams and parsing the received data:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>WebSocket<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ws'</span>

<span class="token keyword">const</span> <span class="token constant">RPC_WS</span> <span class="token operator">=</span> <span class="token string">&quot;ws://localhost:26657/websocket&quot;</span>

<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token constant">RPC_WS</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> start <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Subscribe on </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">RPC_WS</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token parameter">attributes<span class="token punctuation">,</span> which</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> attributes<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> attr<span class="token punctuation">.</span>key <span class="token operator">===</span> which<span class="token punctuation">)</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span>value
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseStreamDeposit</span><span class="token punctuation">(</span><span class="token parameter">attributes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;sender&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> receiver <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;receiver&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> amount <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;amount_deposited&quot;</span><span class="token punctuation">)</span>

    msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Top Up deposit: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sender<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>receiver<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

    <span class="token keyword">return</span> msg
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseCreateStream</span><span class="token punctuation">(</span><span class="token parameter">attributes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;sender&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> receiver <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;receiver&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> flowRate <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;flow_rate&quot;</span><span class="token punctuation">)</span>

    msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Create Stream: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sender<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>receiver<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>flowRate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> nund/sec</span><span class="token template-punctuation string">`</span></span>

    <span class="token keyword">return</span> msg
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseClaimStream</span><span class="token punctuation">(</span><span class="token parameter">attributes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;sender&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> receiver <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;receiver&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> amount <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;claim_total&quot;</span><span class="token punctuation">)</span>

    msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Claim Stream: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sender<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>receiver<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>amount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

    <span class="token keyword">return</span> msg
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseUpdateFlowRate</span><span class="token punctuation">(</span><span class="token parameter">attributes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;sender&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> receiver <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;receiver&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> oldFlowRate <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;old_flow_rate&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> newFlowRate <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;new_flow_rate&quot;</span><span class="token punctuation">)</span>

    msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Update Flow Rate: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sender<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>receiver<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oldFlowRate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newFlowRate<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> nund/sec</span><span class="token template-punctuation string">`</span></span>

    <span class="token keyword">return</span> msg
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseCancelStream</span><span class="token punctuation">(</span><span class="token parameter">attributes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;sender&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> receiver <span class="token operator">=</span> <span class="token function">getAttr</span><span class="token punctuation">(</span>attributes<span class="token punctuation">,</span> <span class="token string">&quot;receiver&quot;</span><span class="token punctuation">)</span>

    msg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Stream Cancelled: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sender<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>receiver<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

    <span class="token keyword">return</span> msg
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">parseEvent</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;stream_deposit&quot;</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token function">parseStreamDeposit</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">&quot;create_stream&quot;</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token function">parseCreateStream</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">&quot;claim_stream&quot;</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token function">parseClaimStream</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">&quot;update_flow_rate&quot;</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token function">parseUpdateFlowRate</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">&quot;cancel_stream&quot;</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token function">parseCancelStream</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>attributes<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> message
<span class="token punctuation">}</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;method&quot;</span><span class="token operator">:</span> <span class="token string">&quot;subscribe&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;params&quot;</span><span class="token operator">:</span>
            <span class="token punctuation">[</span><span class="token string">&quot;message.module='stream'&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> start <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">incoming</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> blockHeight <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>data<span class="token operator">?.</span>value<span class="token punctuation">.</span>TxResult<span class="token punctuation">.</span>height
    <span class="token keyword">let</span> txHash

    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>result<span class="token operator">?.</span>events<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        txHash <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token operator">?.</span>events<span class="token punctuation">[</span><span class="token string">&quot;tx.hash&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>data<span class="token operator">?.</span>value<span class="token punctuation">.</span>TxResult<span class="token punctuation">.</span>result<span class="token punctuation">.</span>events<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> e <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>data<span class="token operator">?.</span>value<span class="token punctuation">.</span>TxResult<span class="token punctuation">.</span>result<span class="token punctuation">.</span>events<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">parseEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>msg <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>blockHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> in Tx </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>txHash<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">WebSocket error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mainchain/streams/cli.html" class="prev">
        und CLI
      </a></span> <span class="next"><a href="/mainchain/streams/developer-guide-react.html">
        Developer Guide: React Hooks
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.55c2b24c.js" defer></script><script src="/assets/js/2.ab437a62.js" defer></script><script src="/assets/js/460.510ee695.js" defer></script>
  </body>
</html>
