(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{342:function(e,t,s){"use strict";s.r(t);var a=s(14),r=Object(a.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"configuring-sentries-for-validators"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuring-sentries-for-validators"}},[e._v("#")]),e._v(" Configuring Sentries (for Validators)")]),e._v(" "),t("p",[e._v('Although not essential, it is highly recommended to configure at least one (preferably two or more) sentries to protect\na validator node. Conceptually, sentries act as a P2P "firewall" for a validator node, protecting it from DDoS\nand other attacks. The validator node runs in private subnet and communicates only with its configured sentries,\nwhich relay information to and from the public blockchain network.')]),e._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),t("p",[e._v("The Validator should have egress access to the Internet via a configured NAT or Proxy to allow for software updates etc.")])]),e._v(" "),t("p",[e._v("This guide will outline the steps and configurations required to set up a 2-Sentry network. It will use generic\nIP addresses and pseudo firewall rules for demonstration purposes only and should therefore not be copied verbatim to\nyour own configuration. SSH configuration is out of scope for this guide, which will only deal with the required\nP2P ports. It is assumed the reader has configured their own SSH tunnel, Bastion etc. for access to their nodes.")]),e._v(" "),t("h2",{attrs:{id:"example-network"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#example-network"}},[e._v("#")]),e._v(" Example Network")]),e._v(" "),t("p",[e._v("Cloud platforms each have their own methods for configuring public and private subnets. Generally, hosts on a private\nsubnet will not be assigned a public IP and will require Internet access via a NAT gateway or similar. Hosts on a public\nsubnet will be assigned a public IP, and will have direct access to the Internet. If the subnets are created within\nthe same VPN, then communication should be possible between hosts on the different subnets.")]),e._v(" "),t("p",[e._v("Configuring VPNs and subnets is out of scope for this guide")]),e._v(" "),t("h3",{attrs:{id:"validator"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#validator"}},[e._v("#")]),e._v(" Validator")]),e._v(" "),t("p",[e._v("Private Subnet"),t("br"),e._v("\nPrivate IP: "),t("code",[e._v("10.0.0.3")]),t("br"),e._v("\nPublic IP: N/A")]),e._v(" "),t("h3",{attrs:{id:"sentry-1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sentry-1"}},[e._v("#")]),e._v(" Sentry 1")]),e._v(" "),t("p",[e._v("Public Subnet"),t("br"),e._v("\nPrivate IP: "),t("code",[e._v("10.1.1.4")]),t("br"),e._v("\nPublic IP: "),t("code",[e._v("123.123.22.33")])]),e._v(" "),t("h3",{attrs:{id:"sentry-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sentry-2"}},[e._v("#")]),e._v(" Sentry 2")]),e._v(" "),t("p",[e._v("Public Subnet"),t("br"),e._v("\nPrivate IP: "),t("code",[e._v("10.1.1.5")]),t("br"),e._v("\nPublic IP: "),t("code",[e._v("234.234.33.44")])]),e._v(" "),t("h2",{attrs:{id:"firewall-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#firewall-configuration"}},[e._v("#")]),e._v(" Firewall Configuration")]),e._v(" "),t("p",[e._v("There should be two firewall rules covering P2P access - one for private access between sentries and the Validator, and\nanother of public P2P access. For example:")]),e._v(" "),t("ol",[t("li",[e._v("Validator - allow ingress on port "),t("code",[e._v("26656")]),e._v(" from "),t("code",[e._v("10.1.1.4/32")]),e._v(" (Sentry 1) and "),t("code",[e._v("10.1.1.5/32")]),e._v(" (Sentry 2)")]),e._v(" "),t("li",[e._v("Sentries - allow ingres access on port "),t("code",[e._v("26656")]),e._v(" from "),t("code",[e._v("0.0.0.0/0")]),e._v(" (everyone)")])]),e._v(" "),t("h2",{attrs:{id:"node-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-configuration"}},[e._v("#")]),e._v(" Node Configuration")]),e._v(" "),t("p",[e._v("The Sentry nodes should be installed, running, and fully synced. Once fully synced, it is possible to reconfigure the\nnodes to communicate directly with each other by editing the "),t("code",[e._v(".und_mainchain/config/config.toml")]),e._v(" file.")]),e._v(" "),t("p",[e._v("All configuration parameters are in the "),t("code",[e._v("[p2p]")]),e._v(" section of "),t("code",[e._v("config.toml")])]),e._v(" "),t("h3",{attrs:{id:"validator-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#validator-2"}},[e._v("#")]),e._v(" Validator")]),e._v(" "),t("p",[e._v("The Valildator's "),t("code",[e._v("config.toml")]),e._v(" should contain somethign along the lines of:")]),e._v(" "),t("div",{staticClass:"language-toml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("seeds")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('""')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("pex")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("persistent_peers")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sentry_1_node_id@10.1.1.4:26656,sentry_2_node_id@10.1.1.5:26656"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("unconditional_peer_ids")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"sentry_1_node_id,sentry_2_node_id"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("addr_book_strict")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n")])])]),t("ul",[t("li",[t("code",[e._v("seeds")]),e._v(" is not required to be set, because the validator should not communicate directly with other P2P nodes that are\nnot its sentries, or broadcast its P2P address.")]),e._v(" "),t("li",[t("code",[e._v("pex")]),e._v(" is set to "),t("code",[e._v("false")]),e._v(", since the validator will not broadcast or consume the wider network's P2P data.")]),e._v(" "),t("li",[t("code",[e._v("persistent_peers")]),e._v(" is set to the two Sentry nodes' P2P addresses.")]),e._v(" "),t("li",[t("code",[e._v("unconditional_peer_ids")]),e._v(" ensures that the validator will always try to connect to the sentry nodes.")]),e._v(" "),t("li",[t("code",[e._v("addr_book_strict")]),e._v(" allows the node address book to store private IP addresses, since "),t("code",[e._v("persistent_peers")]),e._v(" is configured\nto use the private IPs of the sentry nodes.")])]),e._v(" "),t("h3",{attrs:{id:"sentry-1-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sentry-1-2"}},[e._v("#")]),e._v(" Sentry 1")]),e._v(" "),t("p",[e._v("Sentry 1 should be configured to connect to the Validator and to Sentry 2, for example:")]),e._v(" "),t("div",{staticClass:"language-toml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("seeds")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0c2b65bc604a18a490f5f55bb7b4140cfb512ced@seed1.unification.io:26656,e66e0f89af19da09f676c85b262d591b8c2bb9d8@seed2.unification.io:26656"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("pex")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("persistent_peers")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"validator_node_id@10.0.0.3:26656,sentry_2_node_id@234.234.33.44:26656,"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("unconditional_peer_ids")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"validator_node_id,sentry_2_node_id"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("private_peer_ids")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"validator_node_id"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("addr_book_strict")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n")])])]),t("ul",[t("li",[t("code",[e._v("seeds")]),e._v(" is set as normal, so that the Sentry can query for more P2P addresses and broadcast its own")]),e._v(" "),t("li",[t("code",[e._v("pex")]),e._v(" is set to true to allow for P2P address propagation")]),e._v(" "),t("li",[t("code",[e._v("persistent_peers")]),e._v(" is set to the Validator (private IP), and optionally Sentry 2. Note that for Sentry 2 the public IP\nis used, otherwise the private IP version of the node address would be stored in its address book and broadcast.")]),e._v(" "),t("li",[t("code",[e._v("unconditional_peer_ids")]),e._v(" is set to the Validator's Node ID and optionally Sentry 2's Node ID")]),e._v(" "),t("li",[t("code",[e._v("private_peer_ids")]),e._v(" is set to the Validator's Node ID to ensure that its P2P address is never gossiped/broadcast to the\nnetwork.")]),e._v(" "),t("li",[t("code",[e._v("addr_book_strict")]),e._v(" is set to false to allow the node to store the validator's private IP.")])]),e._v(" "),t("h3",{attrs:{id:"sentry-2-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sentry-2-2"}},[e._v("#")]),e._v(" Sentry 2")]),e._v(" "),t("p",[e._v("Sentry 2 should be configured to connect to the Validator and to Sentry 1, for example:")]),e._v(" "),t("div",{staticClass:"language-toml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("seeds")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0c2b65bc604a18a490f5f55bb7b4140cfb512ced@seed1.unification.io:26656,e66e0f89af19da09f676c85b262d591b8c2bb9d8@seed2.unification.io:26656"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("pex")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("persistent_peers")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"validator_node_id@10.0.0.3:26656,sentry_1_node_id@123.123.22.33:26656,"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("unconditional_peer_ids")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"validator_node_id,sentry_1_node_id"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("private_peer_ids")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"validator_node_id"')]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[e._v("addr_book_strict")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),e._v("\n")])])]),t("p",[e._v("Notes are similar to those outlined for Sentry 1.")])])}),[],!1,null,null,null);t.default=r.exports}}]);